# Краткое содержание "Apache Kafka. Потоковая обработка и анализ данных", 2-е издание, Гвен Шапира, Тодд Палино, Раджини Сиварам, Крит Петти

## Описание

Это мой конспект
книги ["Краткое содержание "Apache Kafka. Потоковая обработка и анализ данных", 2-е издание, Гвен Шапира, Тодд Палино, Раджини Сиварам, Крит Петти](https://www.piter.com/collection/bestsellery-oreilly/product/apache-kafka-potokovaya-obrabotka-i-analiz-dannyh-2-e-izdanie) (
сайт российского издательства).

Если Вы автор и считаете, что данный конспект нарушает авторские права - прошу сообщить, я сделаю этот репозиторий
приватным.

Нашли опечатку/неточность? Пишите - разберемся.

[Связаться со мной](https://t.me/szachesov)

# 1 Знакомьтесь: Kafka

## 1.1 Обмен сообщениями по типу "публикация/подписка"

Обмен сообщениям по типу "публикация/подписка"(publish/subscribe(pub/sub) messaging) - паттерн проектирования, в котором
отправитель(издатель) элемента данных(сообщений) не направляет его конкретному потребителю. Вместо этого он
классифицирует сообщения, а потребитель(подписчик) подписывается на определенные их классы.

## 1.2 Открываем для себя систему Kafka

**Apache Kafka** - система обмена сообщения по принципу "публикация/подписка". Её также называют **распределенной
платформой
потоковой обработки**.

Данные в Kafka хранятся долго, упорядочено. Их можно читать когда угодно, они могут распределяться по системе либо ради
защиты от сбоев, либо ради производительности.

## 1.2.1 Сообщения и пакеты

**Сообщения (message)** - единица данных в Kafka. Аналогия в БД - строки(row) или запись(record). Для Kafka это просто
массив байтов.

**Ключ (key)** - фрагмент метаданных, который может быть в сообщении. Может использоваться для лучшего управления
сообщениями в разделе. Простейшая схема - подобна распределению `value` при записи в `java.util.HasMap`.

**Пакет (batch)** - набор сообщений, относящиеся к одному топику или разделу. Используется для производительности. При
этом следует соблюдать баланс времени задержки-пропускной способности.

## 1.2.2 Схемы

**Схема** - дополнительная структура на содержимое сообщения. Варианты задания схемы: JSON, XML, Apache Avro и др.

Для Kafka важен единообразный формат данных.

## 1.2.3 Топики и разделы

**Топик (topic)** - категории, служащие для распределения сообщений. Аналогия БД - таблица.

**Разделы, партиции (partitions)** - единицы топиков. Сообщения записываются в него добавлением в конец, а читаются по
порядку от
начала.

Топик, состоящий из нескольких разделов не гарантирует упорядоченность сообщений в пределах всего топика - только в
разделе.

Разделы можно разместить на разные сервера и/или реплицировать.

**Поток данных (stream)** - данные, перемещающиеся от производителя к потребителю в рамках всего топика.

## 1.2.4 Производители и потребители

Типы пользователей Kafka: производитель, потребитель. Для клиентских API(например, Kafka Streams) производители и
потребители выступают в качестве строительных блоков и предоставляют более высокий уровень взаимодействия.

**Производитель (producer)** - генерирует новые сообщения для конкретного топика. По умолчанию будет поставлять
сообщения по всем партициям, а может в конкретный

**Потребитель (consumers)** - читают сообщения. Подписывается на один топик или более и читает в порядке их возрастания.

**Смещение, офсет (offset)** - непрерывно возрастающее целочисленное значение, ещё один элемент метаданных. Обычно
значение сохраняется в хранилище Kafka, что бы потребитель приостанавливал и возобновлял чтение с нужного места.

**Группы потребителей (consumer groups)** - один или несколько потребителей, объединившихся для обработки топика. В
группе гарантируется, что несколько потребителей не могут читать одну партицию.

**Владение (ownership)** - соответствие потребителя партиции.

## 1.2.5 Брокеры и кластеры

**Брокер (broker)** - отдельный сервер Kafka. Они получают сообщения от производителей, присваивают смещение и
записывают в дисковое хранилище. И обслуживает потребителей.

**Кластер (cluster)** - группа брокеров.

**Контроллер (cluster controller)** - один из брокеров в рамках кластера. Выбирает автоматически. Отвечает за
администрирование операций, распределение разделов по брокерам и мониторинг отказов последних.

**Ведущий (leader)** - брокер, которому принадлежит один раздел.

**Последователи (followers)** - помещается реплицированный раздел.

Производители соединяются с ведущим, потребители получают сообщения либо от ведущего, либо из последователя.

**Сохранение информации (retention)** - ключевая возможность Kafka, в течение длительного времени.

**Сжатые журналы (log compacted)** - механизм хранения данных в топиках, например хранения последнего сообщения с
конкретным ключом.

## 1.2.6 Несколько кластеров

Преимущества больших систем с несколькими кластерами:

* Разделение типов данных
* Изоляция по требованиям безопасности
* Несколько центров обработки данных

Репликация осуществляется в рамках одного кластера, но не нескольких кластеров.

Для возможности репликации данных между кластерами, можно использовать утилиту **MirrorMarker**.






